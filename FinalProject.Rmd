---
title: "Final Project"
author: "Yunqiu Yao, Cenai Zhang, Yutian Mu, Murrel Pereira"
date: "12/9/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(readxl)
library(janitor)
library(olsrr)
```

```{r}
### clean the date
gh = read_excel("./GHProject_Dataset.xlsx") %>% 
  clean_names %>% 
  separate(admitdtm, c("admit_dow","date","year"), ",") %>% 
  mutate(date = trimws(date, "left")) %>% 
  separate(date,c("month","sdate")," ") %>% 
  mutate(month = as.numeric(match(month,month.name)),
         sdate = as.numeric(sdate),
         year = as.numeric(year),
         admit_date = paste(month, sdate, year, sep="-"),
         admit_date = as.Date(admit_date, "%m-%d-%Y")) %>%
  select(-c(sdate,year,month)) %>% 
  mutate(log_losday = log(losdays2))

### remove the duplicate visits
gh = gh[order(gh$date),]
gh_unique <- gh[!duplicated(gh$patientid),]

### recode the levels of categorical variables
gh_tidy = gh_unique %>% 
  mutate(mews = as.factor(ifelse(mews <= 1, "normal", ifelse(mews <= 3, "increase caution", ifelse(mews <= 5, "further desterioration", "immediate action required")))),
         cindex = as.factor(ifelse(cindex == 0, "normal", ifelse(cindex <= 2, "mild", ifelse(cindex <= 4, "moderate", "severe")))),
         is30dayreadmit = as.factor(is30dayreadmit),
         icu_flag = as.factor(icu_flag)) %>% 
  select(log_losday, losdays2, patientid, visitid, admit_date, admit_dow, everything(), -loshours, -facilityname, -facilityzip, -postalcode)
```

```{r}
#try transformation of the outcome
gh %>%
ggplot(aes(x = losdays2)) +  geom_histogram()

gh %>%
ggplot(aes(x = log(losdays2))) +  geom_histogram()
```


